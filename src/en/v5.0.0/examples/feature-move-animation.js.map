{"version":3,"sources":["webpack:///./feature-move-animation.js"],"names":["polyline","join","route","_src_ol_format_Polyline_js__WEBPACK_IMPORTED_MODULE_3__","factor","readGeometry","dataProjection","featureProjection","routeCoords","getCoordinates","routeLength","length","routeFeature","_src_ol_Feature_js__WEBPACK_IMPORTED_MODULE_0__","type","geometry","geoMarker","_src_ol_geom_Point_js__WEBPACK_IMPORTED_MODULE_4__","startMarker","endMarker","styles","_src_ol_style_js__WEBPACK_IMPORTED_MODULE_8__","stroke","width","color","icon","image","anchor","src","radius","snapToPixel","fill","speed","now","animating","speedInput","document","getElementById","startButton","vectorLayer","_src_ol_layer_js__WEBPACK_IMPORTED_MODULE_5__","source","_src_ol_source_Vector_js__WEBPACK_IMPORTED_MODULE_7__","features","style","feature","get","center","map","_src_ol_Map_js__WEBPACK_IMPORTED_MODULE_1__","target","loadTilesWhileAnimating","view","_src_ol_View_js__WEBPACK_IMPORTED_MODULE_2__","zoom","minZoom","maxZoom","layers","_src_ol_source_BingMaps_js__WEBPACK_IMPORTED_MODULE_6__","imagerySet","key","moveFeature","event","vectorContext","frameState","elapsedTime","time","index","Math","round","stopAnimation","currentPoint","drawFeature","render","ended","textContent","coord","getGeometry","setCoordinates","un","addEventListener","Date","getTime","value","setStyle","getView","setCenter","on"],"mappings":"6KAYA,MAAAA,GACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,wEACA,qDACAC,KAAA,IAEAC,EAA8D,IAAAC,EAAA,GAC9DC,OAAA,MACCC,aAAAL,GACDM,eAAA,YACAC,kBAAA,cAGAC,EAAAN,EAAAO,iBACAC,EAAAF,EAAAG,OAEAC,EAAA,IAAAC,EAAA,GACAC,KAAA,QACAC,SAAAb,IAEAc,EAAA,IAAAH,EAAA,GACAC,KAAA,YACAC,SAAA,IAAAE,EAAA,EAAAT,EAAA,MAEAU,EAAA,IAAAL,EAAA,GACAC,KAAA,OACAC,SAAA,IAAAE,EAAA,EAAAT,EAAA,MAEAW,EAAA,IAAAN,EAAA,GACAC,KAAA,OACAC,SAAA,IAAAE,EAAA,EAAAT,EAAAE,EAAA,MAGAU,GACAlB,MAAA,IAAAmB,EAAA,GACAC,OAAA,IAAAD,EAAA,GACAE,MAAA,EAAAC,OAAA,kBAGAC,KAAA,IAAAJ,EAAA,GACAK,MAAA,IAAAL,EAAA,GACAM,QAAA,MACAC,IAAA,oBAGAZ,UAAA,IAAAK,EAAA,GACAK,MAAA,IAAAL,EAAA,GACAQ,OAAA,EACAC,aAAA,EACAC,KAAA,IAAAV,EAAA,GAAsBG,MAAA,UACtBF,OAAA,IAAAD,EAAA,GACAG,MAAA,QAAAD,MAAA,SAMA,IACAS,EAAAC,EADAC,GAAA,EAEA,MAAAC,EAAAC,SAAAC,eAAA,SACAC,EAAAF,SAAAC,eAAA,mBAEAE,EAAA,IAAAC,EAAA,GACAC,OAAA,IAAAC,EAAA,GACAC,UAAA/B,EAAAI,EAAAE,EAAAC,KAEAyB,MAAA,SAAAC,GAEA,OAAAX,GAAA,cAAAW,EAAAC,IAAA,QACA,KAEA1B,EAAAyB,EAAAC,IAAA,YAIAC,IAAA,wBACAC,EAAA,IAAAC,EAAA,GACAC,OAAAd,SAAAC,eAAA,OACAc,yBAAA,EACAC,KAAA,IAAAC,EAAA,GACAN,SACAO,KAAA,GACAC,QAAA,EACAC,QAAA,KAEAC,QACA,IAAAjB,EAAA,GACAC,OAAA,IAAAiB,EAAA,GACAC,WAAA,mBACAC,IAAA,uEAGArB,KAIAsB,EAAA,SAAAC,GACA,MAAAC,EAAAD,EAAAC,cACAC,EAAAF,EAAAE,WAEA,GAAA9B,EAAA,CACA,MAAA+B,EAAAD,EAAAE,KAAAjC,EAGAkC,EAAAC,KAAAC,MAAArC,EAAAiC,EAAA,KAEA,GAAAE,GAAAzD,EAEA,YADA4D,GAAA,GAIA,MAAAC,EAAA,IAAAtD,EAAA,EAAAT,EAAA2D,IACAtB,EAAA,IAAAhC,EAAA,EAAA0D,GACAR,EAAAS,YAAA3B,EAAAzB,EAAAJ,WAGAgC,EAAAyB,UAwBA,SAAAH,EAAAI,GACAxC,GAAA,EACAI,EAAAqC,YAAA,kBAGA,MAAAC,EAAAF,EAAAlE,EAAAE,EAAA,GAAAF,EAAA,GACwCQ,EAAA6D,cACxCC,eAAAF,GAEA5B,EAAA+B,GAAA,cAAAlB,GAGAvB,EAAA0C,iBAAA,QAjCA,WACA9C,EACAoC,GAAA,IAEApC,GAAA,EACAD,GAAA,IAAAgD,MAAAC,UACAlD,EAAAG,EAAAgD,MACA7C,EAAAqC,YAAA,mBAEA3D,EAAAoE,SAAA,MAEApC,EAAAqC,UAAAC,UAAAvC,GACAC,EAAAuC,GAAA,cAAA1B,GACAb,EAAAyB,YAoBA","file":"feature-move-animation.js","sourcesContent":["import Feature from '../src/ol/Feature.js';\nimport Map from '../src/ol/Map.js';\nimport View from '../src/ol/View.js';\nimport Polyline from '../src/ol/format/Polyline.js';\nimport Point from '../src/ol/geom/Point.js';\nimport {Tile as TileLayer, Vector as VectorLayer} from '../src/ol/layer.js';\nimport BingMaps from '../src/ol/source/BingMaps.js';\nimport VectorSource from '../src/ol/source/Vector.js';\nimport {Circle as CircleStyle, Fill, Icon, Stroke, Style} from '../src/ol/style.js';\n\n// This long string is placed here due to jsFiddle limitations.\n// It is usually loaded with AJAX.\nconst polyline = [\n  'hldhx@lnau`BCG_EaC??cFjAwDjF??uBlKMd@}@z@??aC^yk@z_@se@b[wFdE??wFfE}N',\n  'fIoGxB_I\\\\gG}@eHoCyTmPqGaBaHOoD\\\\??yVrGotA|N??o[N_STiwAtEmHGeHcAkiA}^',\n  'aMyBiHOkFNoI`CcVvM??gG^gF_@iJwC??eCcA]OoL}DwFyCaCgCcCwDcGwHsSoX??wI_E',\n  'kUFmq@hBiOqBgTwS??iYse@gYq\\\\cp@ce@{vA}s@csJqaE}{@iRaqE{lBeRoIwd@_T{]_',\n  'Ngn@{PmhEwaA{SeF_u@kQuyAw]wQeEgtAsZ}LiCarAkVwI}D??_}RcjEinPspDwSqCgs@',\n  'sPua@_OkXaMeT_Nwk@ob@gV}TiYs[uTwXoNmT{Uyb@wNg]{Nqa@oDgNeJu_@_G}YsFw]k',\n  'DuZyDmm@i_@uyIJe~@jCg|@nGiv@zUi_BfNqaAvIow@dEed@dCcf@r@qz@Egs@{Acu@mC',\n  'um@yIey@gGig@cK_m@aSku@qRil@we@{mAeTej@}Tkz@cLgr@aHko@qOmcEaJw~C{w@ka',\n  'i@qBchBq@kmBS{kDnBscBnFu_Dbc@_~QHeU`IuyDrC_}@bByp@fCyoA?qMbD}{AIkeAgB',\n  'k_A_A{UsDke@gFej@qH{o@qGgb@qH{`@mMgm@uQus@kL{_@yOmd@ymBgwE}x@ouBwtA__',\n  'DuhEgaKuWct@gp@cnBii@mlBa_@}|Asj@qrCg^eaC}L{dAaJ_aAiOyjByH{nAuYu`GsAw',\n  'Xyn@ywMyOyqD{_@cfIcDe}@y@aeBJmwA`CkiAbFkhBlTgdDdPyiB`W}xDnSa}DbJyhCrX',\n  'itAhT}x@bE}Z_@qW_Kwv@qKaaAiBgXvIm}A~JovAxCqW~WanB`XewBbK{_A`K}fBvAmi@',\n  'xBycBeCauBoF}}@qJioAww@gjHaPopA_NurAyJku@uGmi@cDs[eRaiBkQstAsQkcByNma',\n  'CsK_uBcJgbEw@gkB_@ypEqDoqSm@eZcDwjBoGw`BoMegBaU_`Ce_@_uBqb@ytBwkFqiT_',\n  'fAqfEwe@mfCka@_eC_UmlB}MmaBeWkkDeHwqAoX}~DcBsZmLcxBqOwqE_DkyAuJmrJ\\\\o',\n  '~CfIewG|YibQxBssB?es@qGciA}RorAoVajA_nAodD{[y`AgPqp@mKwr@ms@umEaW{dAm',\n  'b@umAw|@ojBwzDaaJsmBwbEgdCsrFqhAihDquAi`Fux@}_Dui@_eB_u@guCuyAuiHukA_',\n  'lKszAu|OmaA{wKm}@clHs_A_rEahCssKo\\\\sgBsSglAqk@yvDcS_wAyTwpBmPc|BwZknF',\n  'oFscB_GsaDiZmyMyLgtHgQonHqT{hKaPg}Dqq@m~Hym@c`EuiBudIabB{hF{pWifx@snA',\n  'w`GkFyVqf@y~BkoAi}Lel@wtc@}`@oaXi_C}pZsi@eqGsSuqJ|Lqeb@e]kgPcaAu}SkDw',\n  'zGhn@gjYh\\\\qlNZovJieBqja@ed@siO{[ol\\\\kCmjMe\\\\isHorCmec@uLebB}EqiBaCg}',\n  '@m@qwHrT_vFps@kkI`uAszIrpHuzYxx@e{Crw@kpDhN{wBtQarDy@knFgP_yCu\\\\wyCwy',\n  'A{kHo~@omEoYmoDaEcPiuAosDagD}rO{{AsyEihCayFilLaiUqm@_bAumFo}DgqA_uByi',\n  '@swC~AkzDlhA}xEvcBa}Cxk@ql@`rAo|@~bBq{@``Bye@djDww@z_C_cAtn@ye@nfC_eC',\n  '|gGahH~s@w}@``Fi~FpnAooC|u@wlEaEedRlYkrPvKerBfYs}Arg@m}AtrCkzElw@gjBb',\n  'h@woBhR{gCwGkgCc[wtCuOapAcFoh@uBy[yBgr@c@iq@o@wvEv@sp@`FajBfCaq@fIipA',\n  'dy@ewJlUc`ExGuaBdEmbBpBssArAuqBBg}@s@g{AkB{bBif@_bYmC}r@kDgm@sPq_BuJ_',\n  's@{X_{AsK_d@eM{d@wVgx@oWcu@??aDmOkNia@wFoSmDyMyCkPiBePwAob@XcQ|@oNdCo',\n  'SfFwXhEmOnLi\\\\lbAulB`X_d@|k@au@bc@oc@bqC}{BhwDgcD`l@ed@??bL{G|a@eTje@',\n  'oS~]cLr~Bgh@|b@}Jv}EieAlv@sPluD{z@nzA_]`|KchCtd@sPvb@wSb{@ko@f`RooQ~e',\n  '[upZbuIolI|gFafFzu@iq@nMmJ|OeJn^{Qjh@yQhc@uJ~j@iGdd@kAp~BkBxO{@|QsAfY',\n  'gEtYiGd]}Jpd@wRhVoNzNeK`j@ce@vgK}cJnSoSzQkVvUm^rSgc@`Uql@xIq\\\\vIgg@~k',\n  'Dyq[nIir@jNoq@xNwc@fYik@tk@su@neB}uBhqEesFjoGeyHtCoD|D}Ed|@ctAbIuOzqB',\n  '_}D~NgY`\\\\um@v[gm@v{Cw`G`w@o{AdjAwzBh{C}`Gpp@ypAxn@}mAfz@{bBbNia@??jI',\n  'ab@`CuOlC}YnAcV`@_^m@aeB}@yk@YuTuBg^uCkZiGk\\\\yGeY}Lu_@oOsZiTe[uWi[sl@',\n  'mo@soAauAsrBgzBqgAglAyd@ig@asAcyAklA}qAwHkGi{@s~@goAmsAyDeEirB_{B}IsJ',\n  'uEeFymAssAkdAmhAyTcVkFeEoKiH}l@kp@wg@sj@ku@ey@uh@kj@}EsFmG}Jk^_r@_f@m',\n  '~@ym@yjA??a@cFd@kBrCgDbAUnAcBhAyAdk@et@??kF}D??OL'\n].join('');\n\nconst route = /** @type {module:ol/geom/LineString~LineString} */ (new Polyline({\n  factor: 1e6\n}).readGeometry(polyline, {\n  dataProjection: 'EPSG:4326',\n  featureProjection: 'EPSG:3857'\n}));\n\nconst routeCoords = route.getCoordinates();\nconst routeLength = routeCoords.length;\n\nconst routeFeature = new Feature({\n  type: 'route',\n  geometry: route\n});\nconst geoMarker = new Feature({\n  type: 'geoMarker',\n  geometry: new Point(routeCoords[0])\n});\nconst startMarker = new Feature({\n  type: 'icon',\n  geometry: new Point(routeCoords[0])\n});\nconst endMarker = new Feature({\n  type: 'icon',\n  geometry: new Point(routeCoords[routeLength - 1])\n});\n\nconst styles = {\n  'route': new Style({\n    stroke: new Stroke({\n      width: 6, color: [237, 212, 0, 0.8]\n    })\n  }),\n  'icon': new Style({\n    image: new Icon({\n      anchor: [0.5, 1],\n      src: 'data/icon.png'\n    })\n  }),\n  'geoMarker': new Style({\n    image: new CircleStyle({\n      radius: 7,\n      snapToPixel: false,\n      fill: new Fill({color: 'black'}),\n      stroke: new Stroke({\n        color: 'white', width: 2\n      })\n    })\n  })\n};\n\nlet animating = false;\nlet speed, now;\nconst speedInput = document.getElementById('speed');\nconst startButton = document.getElementById('start-animation');\n\nconst vectorLayer = new VectorLayer({\n  source: new VectorSource({\n    features: [routeFeature, geoMarker, startMarker, endMarker]\n  }),\n  style: function(feature) {\n    // hide geoMarker if animation is active\n    if (animating && feature.get('type') === 'geoMarker') {\n      return null;\n    }\n    return styles[feature.get('type')];\n  }\n});\n\nconst center = [-5639523.95, -3501274.52];\nconst map = new Map({\n  target: document.getElementById('map'),\n  loadTilesWhileAnimating: true,\n  view: new View({\n    center: center,\n    zoom: 10,\n    minZoom: 2,\n    maxZoom: 19\n  }),\n  layers: [\n    new TileLayer({\n      source: new BingMaps({\n        imagerySet: 'AerialWithLabels',\n        key: 'As1HiMj1PvLPlqc_gtM7AqZfBL8ZL3VrjaS3zIb22Uvb9WKhuJObROC-qUpa81U5'\n      })\n    }),\n    vectorLayer\n  ]\n});\n\nconst moveFeature = function(event) {\n  const vectorContext = event.vectorContext;\n  const frameState = event.frameState;\n\n  if (animating) {\n    const elapsedTime = frameState.time - now;\n    // here the trick to increase speed is to jump some indexes\n    // on lineString coordinates\n    const index = Math.round(speed * elapsedTime / 1000);\n\n    if (index >= routeLength) {\n      stopAnimation(true);\n      return;\n    }\n\n    const currentPoint = new Point(routeCoords[index]);\n    const feature = new Feature(currentPoint);\n    vectorContext.drawFeature(feature, styles.geoMarker);\n  }\n  // tell OpenLayers to continue the postcompose animation\n  map.render();\n};\n\nfunction startAnimation() {\n  if (animating) {\n    stopAnimation(false);\n  } else {\n    animating = true;\n    now = new Date().getTime();\n    speed = speedInput.value;\n    startButton.textContent = 'Cancel Animation';\n    // hide geoMarker\n    geoMarker.setStyle(null);\n    // just in case you pan somewhere else\n    map.getView().setCenter(center);\n    map.on('postcompose', moveFeature);\n    map.render();\n  }\n}\n\n\n/**\n * @param {boolean} ended end of animation.\n */\nfunction stopAnimation(ended) {\n  animating = false;\n  startButton.textContent = 'Start Animation';\n\n  // if animation cancelled set the marker at the beginning\n  const coord = ended ? routeCoords[routeLength - 1] : routeCoords[0];\n  /** @type {module:ol/geom/Point~Point} */ (geoMarker.getGeometry())\n    .setCoordinates(coord);\n  //remove listener\n  map.un('postcompose', moveFeature);\n}\n\nstartButton.addEventListener('click', startAnimation, false);\n"],"sourceRoot":""}