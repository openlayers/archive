{"version":3,"sources":["webpack:///./export-pdf.js"],"names":["raster","_src_ol_layer_js__WEBPACK_IMPORTED_MODULE_4__","source","_src_ol_source_js__WEBPACK_IMPORTED_MODULE_6__","feature","_src_ol_format_WKT_js__WEBPACK_IMPORTED_MODULE_3__","readFeature","getGeometry","transform","vector","features","map","_src_ol_Map_js__WEBPACK_IMPORTED_MODULE_0__","layers","target","controls","Object","_src_ol_control_js__WEBPACK_IMPORTED_MODULE_2__","attributionOptions","collapsible","view","_src_ol_View_js__WEBPACK_IMPORTED_MODULE_1__","center","zoom","dims","a0","a1","a2","a3","a4","a5","loading","loaded","exportButton","document","getElementById","addEventListener","disabled","body","style","cursor","format","value","resolution","dim","width","Math","round","height","size","getSize","extent","getView","calculateExtent","getSource","tileLoadStart","timer","keys","once","event","tileLoadEnd","canvas","clearTimeout","window","setTimeout","data","toDataURL","pdf","jsPDF","undefined","addImage","save","forEach","_src_ol_Observable_js__WEBPACK_IMPORTED_MODULE_5__","setSize","fit","renderSync","tileLoadEndFactory","context","on","printSize"],"mappings":"+JAQA,MAAAA,EAAA,IAAAC,EAAA,GACAC,OAAA,IAAAC,EAAA,IAIAC,GADA,IAAAC,EAAA,GACAC,YACA,6KAGAF,EAAAG,cAAAC,UAAA,yBAEA,MAAAC,EAAA,IAAAR,EAAA,GACAC,OAAA,IAAAC,EAAA,GACAO,UAAAN,OAKAO,EAAA,IAAAC,EAAA,GACAC,QAAAb,EAAAS,GACAK,OAAA,MACAC,SAAAC,OAAAC,EAAA,EAAAD,EACAE,oBACAC,aAAA,KAGAC,KAAA,IAAAC,EAAA,GACAC,QAAA,KACAC,KAAA,MAKAC,GACAC,IAAA,UACAC,IAAA,SACAC,IAAA,SACAC,IAAA,SACAC,IAAA,SACAC,IAAA,UAGA,IAAAC,EAAA,EACAC,EAAA,EAEA,MAAAC,EAAAC,SAAAC,eAAA,cAEAF,EAAAG,iBAAA,mBAEAH,EAAAI,UAAA,EACAH,SAAAI,KAAAC,MAAAC,OAAA,WAEA,MAAAC,EAAAP,SAAAC,eAAA,UAAAO,MACAC,EAAAT,SAAAC,eAAA,cAAAO,MACAE,EAAApB,EAAAiB,GACAI,EAAAC,KAAAC,MAAAH,EAAA,GAAAD,EAAA,MACAK,EAAAF,KAAAC,MAAAH,EAAA,GAAAD,EAAA,MACAM,EAA8CtC,EAAAuC,UAC9CC,EAAAxC,EAAAyC,UAAAC,gBAAAJ,GAEA/C,EAAAF,EAAAsD,YAEAC,EAAA,aACAxB,GAGA,IAAAyB,EACAC,KA6BA9C,EAAA+C,KAAA,uBAAAC,GACA,MACAC,EA7BA,SAAAC,GACA,aACA7B,EACAwB,IACAM,aAAAN,GACAA,EAAA,MAEAzB,IAAAC,IACAwB,EAAAO,OAAAC,WAAA,KACAjC,EAAA,EACAC,EAAA,EACA,MAAAiC,EAAAJ,EAAAK,UAAA,cACAC,EAAA,IAAAC,MAAA,iBAAAC,EAAA5B,GACA0B,EAAAG,SAAAL,EAAA,WAAArB,EAAA,GAAAA,EAAA,IACAuB,EAAAI,KAAA,WACAd,EAAAe,QAAAC,EAAA,GACAhB,KACA9C,EAAA+D,QAAAzB,GACAtC,EAAAyC,UAAAuB,IAAAxB,GAAqCF,SACrCtC,EAAAiE,aACA3C,EAAAI,UAAA,EACAH,SAAAI,KAAAC,MAAAC,OAAA,QACS,OAOTqC,CADAlB,EAAAmB,QAAAjB,QAEAJ,GACAvD,EAAA6E,GAAA,gBAAAxB,GACArD,EAAA6E,GAAA,cAAAnB,GACA1D,EAAA6E,GAAA,gBAAAnB,IAEAA,MAGA,MAAAoB,GAAAnC,EAAAG,GACArC,EAAA+D,QAAAM,GACArE,EAAAyC,UAAAuB,IAAAxB,GAA6BF,KAAA+B,IAC7BhD,GAAA,EACArB,EAAAiE,eAEC","file":"export-pdf.js","sourcesContent":["import Map from '../src/ol/Map.js';\nimport View from '../src/ol/View.js';\nimport {defaults as defaultControls} from '../src/ol/control.js';\nimport WKT from '../src/ol/format/WKT.js';\nimport {Tile as TileLayer, Vector as VectorLayer} from '../src/ol/layer.js';\nimport {unByKey} from '../src/ol/Observable.js';\nimport {OSM, Vector as VectorSource} from '../src/ol/source.js';\n\nconst raster = new TileLayer({\n  source: new OSM()\n});\n\nconst format = new WKT();\nconst feature = format.readFeature(\n  'POLYGON((10.689697265625 -25.0927734375, 34.595947265625 ' +\n        '-20.1708984375, 38.814697265625 -35.6396484375, 13.502197265625 ' +\n        '-39.1552734375, 10.689697265625 -25.0927734375))');\nfeature.getGeometry().transform('EPSG:4326', 'EPSG:3857');\n\nconst vector = new VectorLayer({\n  source: new VectorSource({\n    features: [feature]\n  })\n});\n\n\nconst map = new Map({\n  layers: [raster, vector],\n  target: 'map',\n  controls: defaultControls({\n    attributionOptions: {\n      collapsible: false\n    }\n  }),\n  view: new View({\n    center: [0, 0],\n    zoom: 2\n  })\n});\n\n\nconst dims = {\n  a0: [1189, 841],\n  a1: [841, 594],\n  a2: [594, 420],\n  a3: [420, 297],\n  a4: [297, 210],\n  a5: [210, 148]\n};\n\nlet loading = 0;\nlet loaded = 0;\n\nconst exportButton = document.getElementById('export-pdf');\n\nexportButton.addEventListener('click', function() {\n\n  exportButton.disabled = true;\n  document.body.style.cursor = 'progress';\n\n  const format = document.getElementById('format').value;\n  const resolution = document.getElementById('resolution').value;\n  const dim = dims[format];\n  const width = Math.round(dim[0] * resolution / 25.4);\n  const height = Math.round(dim[1] * resolution / 25.4);\n  const size = /** @type {module:ol/size~Size} */ (map.getSize());\n  const extent = map.getView().calculateExtent(size);\n\n  const source = raster.getSource();\n\n  const tileLoadStart = function() {\n    ++loading;\n  };\n\n  let timer;\n  let keys = [];\n\n  function tileLoadEndFactory(canvas) {\n    return () => {\n      ++loaded;\n      if (timer) {\n        clearTimeout(timer);\n        timer = null;\n      }\n      if (loading === loaded) {\n        timer = window.setTimeout(() => {\n          loading = 0;\n          loaded = 0;\n          const data = canvas.toDataURL('image/jpeg');\n          const pdf = new jsPDF('landscape', undefined, format);\n          pdf.addImage(data, 'JPEG', 0, 0, dim[0], dim[1]);\n          pdf.save('map.pdf');\n          keys.forEach(unByKey);\n          keys = [];\n          map.setSize(size);\n          map.getView().fit(extent, {size});\n          map.renderSync();\n          exportButton.disabled = false;\n          document.body.style.cursor = 'auto';\n        }, 500);\n      }\n    };\n  }\n\n  map.once('postcompose', function(event) {\n    const canvas = event.context.canvas;\n    const tileLoadEnd = tileLoadEndFactory(canvas);\n    keys = [\n      source.on('tileloadstart', tileLoadStart),\n      source.on('tileloadend', tileLoadEnd),\n      source.on('tileloaderror', tileLoadEnd)\n    ];\n    tileLoadEnd();\n  });\n\n  const printSize = [width, height];\n  map.setSize(printSize);\n  map.getView().fit(extent, {size: printSize});\n  loaded = -1;\n  map.renderSync();\n\n}, false);\n"],"sourceRoot":""}