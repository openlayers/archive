{"version":3,"sources":["webpack:///./sea-level.js"],"names":["const","key","elevation","source","url","crossOrigin","on","evt","context","imageSmoothingEnabled","msImageSmoothingEnabled","raster","sources","operation","pixels","data","pixel","level","map","target","layers","opacity","view","center","zoom","control","document","getElementById","output","addEventListener","innerText","value","changed","event","locations","getElementsByClassName","i","ii","length","relocate","dataset","getView","setCenter","split","Number","setZoom"],"mappings":"4FAAA,wEAuBAA,IAAMC,EAAM,4FACNC,EAAY,IAAI,IAAU,CAC9BC,OAAQ,IAAI,IAAI,CACdC,IAAK,gFAAkFH,EACvFI,YAAa,gBAGjBH,EAAUI,GAAG,aAAa,SAASC,GACjCA,EAAIC,QAAQC,uBAAwB,EACpCF,EAAIC,QAAQE,yBAA0B,KAGxCV,IAAMW,EAAS,IAAI,IAAa,CAC9BC,QAAS,CAACV,GACVW,UA9BF,SAAeC,EAAQC,GACrBf,IAAMgB,EAAQF,EAAO,GAYrB,OAXIE,EAAM,KACsE,IAAzC,IAAXA,EAAM,GAAW,IAAiB,IAAXA,EAAM,GAAWA,EAAM,IAAxD,KACFD,EAAKE,OACjBD,EAAM,GAAK,IACXA,EAAM,GAAK,IACXA,EAAM,GAAK,IACXA,EAAM,GAAK,KAEXA,EAAM,GAAK,GAGRA,KAoBHE,EAAM,IAAI,IAAI,CAClBC,OAAQ,MACRC,OAAQ,CACN,IAAI,IAAU,CACZjB,OAAQ,IAAI,IAAS,CACnBC,IAAK,+EAAiFH,EACtFI,YAAa,gBAGjB,IAAI,IAAW,CACbgB,QAAS,GACTlB,OAAQQ,KAGZW,KAAM,IAAI,IAAK,CACbC,OAAQ,YAAW,EAAE,SAAU,UAC/BC,KAAM,OAIJC,EAAUC,SAASC,eAAe,SAClCC,EAASF,SAASC,eAAe,UACvCF,EAAQI,iBAAiB,SAAS,WAChCD,EAAOE,UAAYL,EAAQM,MAC3BpB,EAAOqB,aAETJ,EAAOE,UAAYL,EAAQM,MAE3BpB,EAAOL,GAAG,oBAAoB,SAAS2B,GACrCA,EAAMlB,KAAKE,MAAQQ,EAAQM,SAI7B,IADA/B,IAAMkC,EAAYR,SAASS,uBAAuB,YACzCC,EAAI,EAAGC,EAAKH,EAAUI,OAAQF,EAAIC,IAAMD,EAC/CF,EAAUE,GAAGP,iBAAiB,QAASU,GAGzC,SAASA,EAASN,GAChBjC,IAAMe,EAAOkB,EAAMd,OAAOqB,QACpBlB,EAAOJ,EAAIuB,UACjBnB,EAAKoB,UAAU,YAAW3B,EAAKQ,OAAOoB,MAAM,KAAKzB,IAAI0B,UACrDtB,EAAKuB,QAAQD,OAAO7B,EAAKS,U","file":"sea-level.js","sourcesContent":["import Map from '../src/ol/Map.js';\nimport View from '../src/ol/View.js';\nimport {Image as ImageLayer, Tile as TileLayer} from '../src/ol/layer.js';\nimport {fromLonLat} from '../src/ol/proj.js';\nimport {Raster as RasterSource, TileJSON} from '../src/ol/source.js';\nimport XYZ from '../src/ol/source/XYZ.js';\n\nfunction flood(pixels, data) {\n  const pixel = pixels[0];\n  if (pixel[3]) {\n    const height = -10000 + ((pixel[0] * 256 * 256 + pixel[1] * 256 + pixel[2]) * 0.1);\n    if (height <= data.level) {\n      pixel[0] = 145;\n      pixel[1] = 175;\n      pixel[2] = 186;\n      pixel[3] = 255;\n    } else {\n      pixel[3] = 0;\n    }\n  }\n  return pixel;\n}\n\nconst key = 'pk.eyJ1IjoidHNjaGF1YiIsImEiOiJjaW5zYW5lNHkxMTNmdWttM3JyOHZtMmNtIn0.CDIBD8H-G2Gf-cPkIuWtRg';\nconst elevation = new TileLayer({\n  source: new XYZ({\n    url: 'https://api.mapbox.com/v4/mapbox.terrain-rgb/{z}/{x}/{y}.pngraw?access_token=' + key,\n    crossOrigin: 'anonymous'\n  })\n});\nelevation.on('prerender', function(evt) {\n  evt.context.imageSmoothingEnabled = false;\n  evt.context.msImageSmoothingEnabled = false;\n});\n\nconst raster = new RasterSource({\n  sources: [elevation],\n  operation: flood\n});\n\nconst map = new Map({\n  target: 'map',\n  layers: [\n    new TileLayer({\n      source: new TileJSON({\n        url: 'https://api.tiles.mapbox.com/v4/mapbox.world-light.json?secure&access_token=' + key,\n        crossOrigin: 'anonymous'\n      })\n    }),\n    new ImageLayer({\n      opacity: 0.6,\n      source: raster\n    })\n  ],\n  view: new View({\n    center: fromLonLat([-122.3267, 37.8377]),\n    zoom: 11\n  })\n});\n\nconst control = document.getElementById('level');\nconst output = document.getElementById('output');\ncontrol.addEventListener('input', function() {\n  output.innerText = control.value;\n  raster.changed();\n});\noutput.innerText = control.value;\n\nraster.on('beforeoperations', function(event) {\n  event.data.level = control.value;\n});\n\nconst locations = document.getElementsByClassName('location');\nfor (let i = 0, ii = locations.length; i < ii; ++i) {\n  locations[i].addEventListener('click', relocate);\n}\n\nfunction relocate(event) {\n  const data = event.target.dataset;\n  const view = map.getView();\n  view.setCenter(fromLonLat(data.center.split(',').map(Number)));\n  view.setZoom(Number(data.zoom));\n}\n"],"sourceRoot":""}