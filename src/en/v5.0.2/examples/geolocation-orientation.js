(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{359:function(t,e,n){"use strict";n.r(e);var o=n(173),a=n(3),i=n(96),c=n(2),s=n(243),r=n(32),d=n(4),u=n(8),g=n(5);const l=new c.a({center:Object(u.f)([5.8713,45.6452]),zoom:19}),p=new a.a({layers:[new d.a({source:new g.b})],target:"map",controls:Object(s.a)({attributionOptions:{collapsible:!1}}),view:l}),m=document.getElementById("geolocation_marker"),h=new i.a({positioning:"center-center",element:m,stopEvent:!1});p.addOverlay(h);const f=new r.a([],"XYZM"),w=new o.a({projection:l.getProjection(),trackingOptions:{maximumAge:1e4,enableHighAccuracy:!0,timeout:6e5}});let M=500;w.on("change",function(){const t=w.getPosition(),e=w.getAccuracy(),n=w.getHeading()||0,o=w.getSpeed()||0;!function(t,e,n,o){const a=t[0],i=t[1],c=f.getCoordinates(),s=c[c.length-1],r=s&&s[2];if(r){let t=e-function(t){return(t%(2*Math.PI)+2*Math.PI)%(2*Math.PI)}(r);if(Math.abs(t)>Math.PI){const e=t>=0?1:-1;t=-e*(2*Math.PI-Math.abs(t))}e=r+t}f.appendCoordinate([a,i,e,n]),f.setCoordinates(f.getCoordinates().slice(-20)),m.src=e&&o?"data/geolocation_marker_heading.png":"data/geolocation_marker.png"}(t,n,Date.now(),o);const a=f.getCoordinates(),i=a.length;i>=2&&(M=(a[i-1][3]-a[0][3])/(i-1));const c=["Position: "+t[0].toFixed(2)+", "+t[1].toFixed(2),"Accuracy: "+e,"Heading: "+Math.round(function(t){return 360*t/(2*Math.PI)}(n))+"&deg;","Speed: "+(3.6*o).toFixed(1)+" km/h","Delta: "+Math.round(M)+"ms"].join("<br />");document.getElementById("info").innerHTML=c}),w.on("error",function(){alert("geolocation error")});let b=0;function y(){let t=Date.now()-1.5*M;t=Math.max(t,b),b=t;const e=f.getCoordinateAtM(t,!0);e&&(l.setCenter(function(t,e,n){const o=p.getSize()[1];return[t[0]-Math.sin(e)*o*n*1/4,t[1]+Math.cos(e)*o*n*1/4]}(e,-e[2],l.getResolution())),l.setRotation(-e[2]),h.setPosition(e))}const I=document.getElementById("geolocate");let P;I.addEventListener("click",function(){w.setTracking(!0),p.on("postcompose",y),p.render(),C()},!1);const k=new XMLHttpRequest;k.open("GET","data/geolocation-orientation.json"),k.onload=function(){P=JSON.parse(k.responseText).data},k.send();const E=document.getElementById("simulate");function j(t){const e=t.coords;w.set("accuracy",e.accuracy),w.set("heading",function(t){return t*Math.PI*2/360}(e.heading));const n=Object(u.f)([e.longitude,e.latitude]);w.set("position",n),w.set("speed",e.speed),w.changed()}function C(){I.disabled="disabled",E.disabled="disabled"}E.addEventListener("click",function(){const t=P,e=t.shift();j(e);let n=e.timestamp;!function e(){const o=t.shift();if(!o)return;const a=o.timestamp;j(o),window.setTimeout(function(){n=a,e()},(a-n)/.5)}(),p.on("postcompose",y),p.render(),C()},!1)}},[[359,0]]]);
//# sourceMappingURL=geolocation-orientation.js.map