<!DOCTYPE html>
<html lang="en-US">
  <head>
    <script>
    var gaProperty = 'UA-2577926-1';
    // Disable tracking if the opt-out cookie exists.
    var disableStr = 'ga-disable-' + gaProperty;
    if (document.cookie.indexOf(disableStr + '=true') > -1) {
      window[disableStr] = true;
    }
    function gaOptout() {
      document.cookie = disableStr + '=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
      window[disableStr] = true;
    }
    function gaOptoutRevoke() {
      document.cookie = disableStr + '=false; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
      window[disableStr] = false;
    }
    </script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2577926-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-2577926-1', { 'anonymize_ip': true });
    </script>
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
    <script src="https://unpkg.com/lz-string@1.4.4/libs/lz-string.min.js"></script>
    <script>
    window.addEventListener("load", function() {
      window.cookieconsent.initialise({
        'palette': {
          'popup': {
            'background': '#eaf7f7',
            'text': '#5c7291'
          },
          'button': {
            'background': '#56cbdb',
            'text': '#ffffff'
          }
        },
        'theme': 'edgeless',
        'type': 'opt-out',
        'onInitialise': function (status) {
          if (!this.hasConsented()) {
            gaOptout()
          }
        },
        'onStatusChange': function(status, chosenBefore) {
          if (!this.hasConsented()) {
            gaOptout()
          }
        },
        'onRevokeChoice': function() {
          gaOptoutRevoke()
        }
      })
    });
    </script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="./resources/prism/prism.css" type="text/css">
    <link rel="stylesheet" href="./css/ol.css" type="text/css">
    <link rel="stylesheet" href="./resources/layout.css" type="text/css">
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=fetch,requestAnimationFrame,Element.prototype.classList,URL"></script>
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js"></script>
    <title>Vector Tile Selection</title>
  </head>
  <body>

    <header class="navbar" role="navigation">
      <div class="container">
        <div class="display-table pull-left" id="navbar-logo-container">
          <a class="navbar-brand" href="./"><img src="./resources/logo-70x70.png">&nbsp;OpenLayers</a>
        </div>
        <!-- menu items that get hidden below 768px width -->
        <nav class='collapse navbar-collapse navbar-responsive-collapse'>
          <ul class="nav navbar-nav pull-right">
            <li><a href="../doc">Docs</a></li>
            <li><a class="active" href="index.html">Examples</a></li>
            <li><a href="../apidoc">API</a></li>
            <li><a href="https://github.com/openlayers/openlayers">Code</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <div class="container-fluid">

      <div id="latest-check" class="alert alert-warning alert-dismissible" role="alert" style="display:none">
        <button id="latest-dismiss" type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        This example uses OpenLayers v<span>6.3.1</span>. The <a id="latest-link" href="#" class="alert-link">latest</a> is v<span id="latest-version"></span>.
      </div>

      <div id="experimental-notice" class="alert alert-warning alert-dismissible" role="alert" style="display:none">
        <button id="experimental-dismiss" type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        This example uses features that are not part of the stable API and subject to change between releases.  Consult the <a href="https://openlayers.org/en/latest/apidoc/">API documentation</a>
        to see what is supported in the latest release.
      </div>

      <div class="row-fluid">
        <a class="codepen-button pull-right"><i class="fa fa-codepen"></i> Edit</a>
        <div class="span12">
          <h4 id="title">
            Vector Tile Selection
          </h4>
          <p class="tags">
              <a href="./index.html?q=vectortiles" class="label label-primary">vectortiles</a>
              <a href="./index.html?q=selection" class="label label-primary">selection</a>
          </p>
          <div id="map" class="map"></div>
<form class="form-inline">
  <label>Action type &nbsp;</label>
  <select id="type" class="form-control">
    <option value="singleselect" selected>Single Select</option>
    <option value="multiselect">Multi Select</option>
    <option value="singleselect-hover">Single Select on hover</option>
  </select>
</form>

        </div>
        <form method="POST" id="codepen-form" target="_blank" action="https://codesandbox.io/api/v1/sandboxes/define">
          <input id="codesandbox-params" type="hidden" name="parameters">
        </form>
      </div>

      <div class="row-fluid">
        <div class="span12">
          <p id="shortdesc">Select features from vector tiles.</p>
          <div id="docs"><p>
  Click a rendered vector-tile feature to highlight it on the map. Click on an empty spot (ocean) to reset the selection.
  By changing the action type to "Multi Select" you can select multiple features at a time. With "Single Select on hover",
  features will be higlighted when the pointer is above them.
</p><p>
  The selection layer is configured with `renderMode: 'vector'` for better performance on frequent redraws,
  i.e. when 'Single select on hover' is selected.
</p>
</div>
        </div>
      </div>

      <div class="row-fluid">
        <div class="source-controls">
          <a class="copy-button" id="copy-html-button" data-clipboard-target="#example-html-source"><i class="fa fa-clipboard"></i> Copy</a>
        </div>
        <pre><legend>index.html</legend><code id="example-html-source" class="language-markup">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;title&gt;Vector Tile Selection&lt;/title&gt;
    &lt;!-- The line below is only needed for old environments like Internet Explorer and Android 4.x --&gt;
    &lt;script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=fetch,requestAnimationFrame,Element.prototype.classList,URL"&gt;&lt;/script&gt;
    &lt;style&gt;
      .map {
        width: 100%;
        height:400px;
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id&#x3D;&quot;map&quot; class&#x3D;&quot;map&quot;&gt;&lt;/div&gt;
    &lt;form class&#x3D;&quot;form-inline&quot;&gt;
      &lt;label&gt;Action type &amp;nbsp;&lt;/label&gt;
      &lt;select id&#x3D;&quot;type&quot; class&#x3D;&quot;form-control&quot;&gt;
        &lt;option value&#x3D;&quot;singleselect&quot; selected&gt;Single Select&lt;/option&gt;
        &lt;option value&#x3D;&quot;multiselect&quot;&gt;Multi Select&lt;/option&gt;
        &lt;option value&#x3D;&quot;singleselect-hover&quot;&gt;Single Select on hover&lt;/option&gt;
      &lt;/select&gt;
    &lt;/form&gt;
    &lt;script src="index.js"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
      </div>
      <div class="row-fluid">
        <div class="source-controls">
          <a class="copy-button" id="copy-js-button" data-clipboard-target="#example-js-source"><i class="fa fa-clipboard"></i> Copy</a>
        </div>
        <pre><legend>index.js</legend><code id="example-js-source" class="language-js">import 'ol/ol.css';
import Map from &#x27;ol/Map&#x27;;
import View from &#x27;ol/View&#x27;;
import MVT from &#x27;ol/format/MVT&#x27;;
import VectorTileLayer from &#x27;ol/layer/VectorTile&#x27;;
import VectorTileSource from &#x27;ol/source/VectorTile&#x27;;
import {Fill, Stroke, Style} from &#x27;ol/style&#x27;;

// lookup for selection objects
var selection &#x3D; {};

var country &#x3D; new Style({
  stroke: new Stroke({
    color: &#x27;gray&#x27;,
    width: 1
  }),
  fill: new Fill({
    color: &#x27;rgba(20,20,20,0.9)&#x27;
  })
});
var selectedCountry &#x3D; new Style({
  stroke: new Stroke({
    color: &#x27;rgba(200,20,20,0.8)&#x27;,
    width: 2
  }),
  fill: new Fill({
    color: &#x27;rgba(200,20,20,0.4)&#x27;
  })
});

var vtLayer &#x3D; new VectorTileLayer({
  declutter: true,
  source: new VectorTileSource({
    maxZoom: 15,
    format: new MVT({
      idProperty: &#x27;iso_a3&#x27;
    }),
    url: &#x27;https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/&#x27; +
      &#x27;ne:ne_10m_admin_0_countries@EPSG%3A900913@pbf/{z}/{x}/{-y}.pbf&#x27;
  }),
  style: country
});

var map &#x3D; new Map({
  layers: [
    vtLayer
  ],
  target: &#x27;map&#x27;,
  view: new View({
    center: [0, 0],
    zoom: 2,
    multiWorld: true
  })
});

// Selection
var selectionLayer &#x3D; new VectorTileLayer({
  map: map,
  renderMode: &#x27;vector&#x27;,
  source: vtLayer.getSource(),
  style: function(feature) {
    if (feature.getId() in selection) {
      return selectedCountry;
    }
  }
});

var selectElement &#x3D; document.getElementById(&#x27;type&#x27;);

map.on([&#x27;click&#x27;, &#x27;pointermove&#x27;], function(event) {
  if (selectElement.value &#x3D;&#x3D;&#x3D; &#x27;singleselect-hover&#x27; &amp;&amp; event.type !&#x3D;&#x3D; &#x27;pointermove&#x27; ||
      selectElement.value !&#x3D;&#x3D; &#x27;singleselect-hover&#x27; &amp;&amp; event.type &#x3D;&#x3D;&#x3D; &#x27;pointermove&#x27;) {
    return;
  }
  vtLayer.getFeatures(event.pixel).then(function(features) {
    if (!features.length) {
      selection &#x3D; {};
      selectionLayer.changed();
      return;
    }
    var feature &#x3D; features[0];
    if (!feature) {
      return;
    }
    var fid &#x3D; feature.getId();

    if (selectElement.value.startsWith(&#x27;singleselect&#x27;)) {
      selection &#x3D; {};
    }
    // add selected feature to lookup
    selection[fid] &#x3D; feature;

    selectionLayer.changed();
  });
});
</code></pre>
      </div>
      <div class="row-fluid">
        <div class="source-controls">
          <a class="copy-button" id="copy-pkg-button" data-clipboard-target="#example-pkg-source"><i class="fa fa-clipboard"></i> Copy</a>
        </div>
        <pre><legend>package.json</legend><code id="example-pkg-source" class="language-js">{
  &quot;name&quot;: &quot;vector-tile-selection&quot;,
  &quot;dependencies&quot;: {
    &quot;ol&quot;: &quot;6.3.1&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;parcel&quot;: &quot;1.11.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;parcel index.html&quot;,
    &quot;build&quot;: &quot;parcel build --experimental-scope-hoisting --public-url . index.html&quot;
  }
}</code></pre>
      </div>
    </div>
    <script src="./resources/common.js"></script>
    <script src="./resources/prism/prism.min.js"></script>
    <script src="common.js"></script><script src="vector-tile-selection.js"></script>
  </body>
  <script>
  var packageUrl = 'https://raw.githubusercontent.com/openlayers/openlayers.github.io/build/package.json';
  fetch(packageUrl).then(function(response) {
    return response.json();
  }).then(function(json) {
    var latestVersion = json.version;
    document.getElementById('latest-version').innerHTML = latestVersion;
    var url = window.location.href;
    var branchSearch = url.match(/\/([^\/]*)\/examples\//);
    var cookieText = 'dismissed=-' + latestVersion + '-';
    var dismissed = document.cookie.indexOf(cookieText) != -1;
    if (branchSearch && !dismissed && /^v[0-9\.]*$/.test(branchSearch[1]) && '6.3.1' != latestVersion) {
      var link = url.replace(branchSearch[0], '/latest/examples/');
      fetch(link, {method: 'head'}).then(function(response) {
        var a = document.getElementById('latest-link');
        a.href = response.status == 200 ? link : '../../latest/examples/';
      });
      var latestCheck = document.getElementById('latest-check');
      latestCheck.style.display = '';
      document.getElementById('latest-dismiss').onclick = function() {
        latestCheck.style.display = 'none';
        document.cookie = cookieText;
      }
    }

    var experimentalNotice = document.getElementById('experimental-notice');
    if (window.experimental) {
      experimentalNotice.style.display = 'block';
      document.getElementById('experimental-dismiss').onclick = function() {
        experimentalNotice.style.display = 'none';
      }
    }

  });
  </script>
</html>
