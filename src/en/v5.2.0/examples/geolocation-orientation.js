(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{270:function(e,t,n){"use strict";n.r(t);var o=n(170),a=n(1),i=n(93),r=n(0),s=n(386),c=n(30),d=n(3),u=n(2),g=n(4),l=new r.a({center:Object(u.f)([5.8713,45.6452]),zoom:19}),p=new a.a({layers:[new d.a({source:new g.b})],target:"map",controls:Object(s.a)({attributionOptions:{collapsible:!1}}),view:l}),m=document.getElementById("geolocation_marker"),h=new i.a({positioning:"center-center",element:m,stopEvent:!1});p.addOverlay(h);var v=new c.a([],"XYZM"),f=new o.a({projection:l.getProjection(),trackingOptions:{maximumAge:1e4,enableHighAccuracy:!0,timeout:6e5}}),w=500;f.on("change",function(){var e=f.getPosition(),t=f.getAccuracy(),n=f.getHeading()||0,o=f.getSpeed()||0;!function(e,t,n,o){var a=e[0],i=e[1],r=v.getCoordinates(),s=r[r.length-1],c=s&&s[2];if(c){var d=t-function(e){return(e%(2*Math.PI)+2*Math.PI)%(2*Math.PI)}(c);if(Math.abs(d)>Math.PI){var u=d>=0?1:-1;d=-u*(2*Math.PI-Math.abs(d))}t=c+d}v.appendCoordinate([a,i,t,n]),v.setCoordinates(v.getCoordinates().slice(-20)),m.src=t&&o?"data/geolocation_marker_heading.png":"data/geolocation_marker.png"}(e,n,Date.now(),o);var a=v.getCoordinates(),i=a.length;i>=2&&(w=(a[i-1][3]-a[0][3])/(i-1));var r=["Position: "+e[0].toFixed(2)+", "+e[1].toFixed(2),"Accuracy: "+t,"Heading: "+Math.round(function(e){return 360*e/(2*Math.PI)}(n))+"&deg;","Speed: "+(3.6*o).toFixed(1)+" km/h","Delta: "+Math.round(w)+"ms"].join("<br />");document.getElementById("info").innerHTML=r}),f.on("error",function(){alert("geolocation error")});var b=0;function updateView(){var e=Date.now()-1.5*w;e=Math.max(e,b),b=e;var t=v.getCoordinateAtM(e,!0);t&&(l.setCenter(function(e,t,n){var o=p.getSize()[1];return[e[0]-Math.sin(t)*o*n*1/4,e[1]+Math.cos(t)*o*n*1/4]}(t,-t[2],l.getResolution())),l.setRotation(-t[2]),h.setPosition(t))}var M,P=document.getElementById("geolocate");P.addEventListener("click",function(){f.setTracking(!0),p.on("postcompose",updateView),p.render(),disableButtons()},!1);var y=new XMLHttpRequest;y.open("GET","data/geolocation-orientation.json"),y.onload=function(){M=JSON.parse(y.responseText).data},y.send();var I=document.getElementById("simulate");function simulatePositionChange(e){var t=e.coords;f.set("accuracy",t.accuracy),f.set("heading",function(e){return e*Math.PI*2/360}(t.heading));var n=Object(u.f)([t.longitude,t.latitude]);f.set("position",n),f.set("speed",t.speed),f.changed()}function disableButtons(){P.disabled="disabled",I.disabled="disabled"}I.addEventListener("click",function(){var e=M,t=e.shift();simulatePositionChange(t);var n=t.timestamp;!function geolocate(){var t=e.shift();if(t){var o=t.timestamp;simulatePositionChange(t),window.setTimeout(function(){n=o,geolocate()},(o-n)/.5)}}(),p.on("postcompose",updateView),p.render(),disableButtons()},!1)}},[[270,0]]]);
//# sourceMappingURL=geolocation-orientation.js.map